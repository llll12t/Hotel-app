<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <title>โอมสเตย์</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Include Flatpickr CSS and JS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <!-- Include config.js สำหรับ API_URL -->
  <script src="config.js"></script>
  <!-- LIFF SDK (หากต้องการใช้งาน ให้ uncomment และตั้งค่า liff.init) -->
  <!-- <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script> -->
</head>

<body class="bg-gray-100 min-h-screen">
  <!-- STEP 1: เลือกห้อง (Index) -->
  <div id="step1" class="p-4 max-w-md mx-auto">
    <h1 class="text-lg font-bold mb-4 text-center">โอมสเตย์ ยินดีต้อนรับ</h1>
    <!-- ใช้ Flatpickr เป็น Date Range Picker -->
    <label class="text-sm text-gray-500 block mb-1 text-center">เลือกวันที่เข้าพักและวันที่ออก</label>
    <div class="bg-white rounded-full px-4 py-2 mb-6 shadow-sm">
      <input type="text" id="step1DateRange" placeholder="เลือกวันที่..."
        class="w-full text-sm text-center focus:outline-none" />
    </div>
    <!-- รายการห้อง -->
    <div id="step1RoomList" class="flex flex-col"></div>
  </div>

  <!-- STEP 2: ดูรายละเอียดห้อง (Detail) -->
  <div id="step2" class="hidden p-4 max-w-md mx-auto">
    <!-- ปุ่มกลับ -->
    <button id="backToStep1" class="text-sm text-blue-500 mb-2 flex items-center space-x-1">
      <span>&larr;</span><span>กลับ</span>
    </button>

    <!-- กล่องรายละเอียดห้อง -->
    <div class="bg-white rounded shadow p-4">
      <!-- รูปหลัก -->
      <img id="detailMainImg" src="" alt="Room" class="w-full h-48 object-cover rounded mb-4" />

      <!-- ส่วนชื่อห้อง + หมวดหมู่ + ราคา + ปุ่มจอง -->
      <div class="flex items-center justify-between mb-3">
        <!-- ชื่อห้อง + หมวดหมู่ -->
        <div>
          <h2 id="detailRoomName" class="font-bold text-base md:text-lg leading-tight"></h2>
          <p id="detailRoomCategory" class="text-sm text-gray-500"></p>
        </div>
        <!-- ราคา + ปุ่มจอง -->
        <div class="text-right">
          <div id="detailRoomPrice" class="text-red-500 font-bold text-base md:text-lg"></div>
          <button id="detailBookBtn" class="mt-2 bg-black text-white text-sm py-1 px-3 rounded">
            จองห้องนี้
          </button>
        </div>
      </div>

      <!-- แสดงฟีเจอร์เพิ่มเติม (แอร์, ที่จอดรถ, สระน้ำ, วิว) -->
      <div id="detailFeatures" class="text-xs text-gray-500 mb-3"></div>

      <!-- แกลเลอรีรูปย่อย -->
      <div id="detailGallery" class="flex space-x-2 overflow-x-auto mb-4">
        <!-- จะถูกเติมรูปภาพย่อยด้วย JS -->
      </div>

      <!-- รายละเอียดเพิ่มเติม -->
      <div id="detailRoomDesc" class="text-sm text-gray-700 mb-2"></div>
      <div id="detailRoomDesc2" class="text-sm text-gray-700 mb-2"></div>

      <!-- รีวิวล่าสุด (ตัวอย่าง) -->
      <div id="reviewSection" class="mt-4">
        <h3 class="font-bold mb-2">รีวิวล่าสุด</h3>
        <!-- ตัวอย่างรีวิว (สามารถปรับให้ดึงจาก API หรือข้อมูลจริงได้) -->
        <div class="space-y-2 text-sm">
          <div class="p-2 bg-gray-50 rounded">
            <div class="font-semibold">คุณ kamin</div>
            <div>ห้องพักสะอาดมากเลยครับ</div>
            <div class="text-right font-bold">5</div>
          </div>
          <div class="p-2 bg-gray-50 rounded">
            <div class="font-semibold">คุณ อลิส</div>
            <div>เยี่ยมมาก</div>
            <div class="text-right font-bold">4.5</div>
          </div>
          <div class="p-2 bg-gray-50 rounded">
            <div class="font-semibold">คุณ สมหวัง</div>
            <div>แล้วจะมาอีก</div>
            <div class="text-right font-bold">5</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 3: ฟอร์มจอง (Booking) -->
  <div id="step3" class="hidden p-4 max-w-md mx-auto">
    <button id="backToStep2" class="text-sm text-blue-500 mb-2 flex items-center space-x-1">
      <span>&larr;</span><span>กลับ</span>
    </button>
    <div class="bg-white p-4 rounded shadow">
      <form id="bookingForm">
        <div class="grid grid-cols-2 gap-3 mb-4">
          <!-- ชื่อห้อง -->
          <div>
            <label class="block text-xs text-gray-500">ชื่อห้อง</label>
            <input type="text" id="bookRoomName"
              class="w-full border-b border-gray-300 bg-white text-sm font-semibold py-1" readonly />
          </div>
          <!-- หมวดหมู่ -->
          <div>
            <label class="block text-xs text-gray-500">หมวดหมู่</label>
            <input type="text" id="bookRoomCategory"
              class="w-full border-b border-gray-300 bg-white text-sm font-semibold py-1" readonly />
          </div>
          <!-- ราคา -->
          <div>
            <label class="block text-xs text-gray-500">ราคา</label>
            <input type="text" id="bookRoomPrice"
              class="w-full border-b border-gray-300 bg-white text-sm font-semibold py-1" readonly />
          </div>
          <!-- จำนวนคืน -->
          <div>
            <label class="block text-xs text-gray-500">จำนวนคืน</label>
            <input type="text" id="bookNightCount"
              class="w-full border-b border-gray-300 bg-white text-sm font-semibold py-1" readonly />
          </div>
          <!-- วันที่เข้าพัก (แยกเป็น text เพื่อแสดง DD-MM-YYYY) -->
          <div>
            <label class="block text-xs text-gray-500">เข้าพักวันที่</label>
            <input type="text" id="bookCheckIn"
              class="w-full border-b border-gray-300 bg-white text-sm font-semibold py-1" readonly />
          </div>
          <!-- วันที่ออก (แยกเป็น text) -->
          <div>
            <label class="block text-xs text-gray-500">ออกวันที่</label>
            <input type="text" id="bookCheckOut"
              class="w-full border-b border-gray-300 bg-white text-sm font-semibold py-1" readonly />
          </div>
        </div>
        <!-- ฟิลด์กรอกข้อมูลการจอง -->
        <div class="mb-4">
          <label class="block text-sm font-semibold mb-1">จำนวนคนเข้าพัก</label>
          <input type="number" id="bookNumGuests" class="w-full border rounded px-2 py-1 text-sm" min="1" value="1" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-semibold mb-1">ชื่อผู้เช่า</label>
          <input type="text" id="bookRenterName" class="w-full border rounded px-2 py-1 text-sm"
            placeholder="เช่น สมชาย ใจดี" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-semibold mb-1">เบอร์ติดต่อ</label>
          <input type="tel" id="bookPhone" class="w-full border rounded px-2 py-1 text-sm"
            placeholder="เช่น 0812345678" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-semibold mb-1">อีเมล</label>
          <input type="email" id="bookEmail" class="w-full border rounded px-2 py-1 text-sm"
            placeholder="example@gmail.com" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-semibold mb-1">หมายเหตุ</label>
          <textarea id="bookNote" class="w-full border rounded px-2 py-1 text-sm" rows="3"></textarea>
        </div>
        <!-- ฟิลด์ซ่อนสำหรับเก็บ userLineId -->
        <input type="hidden" id="bookUserLineId" />
        <button type="button" id="submitBookingBtn" class="bg-black text-white w-full py-2 rounded text-sm">
          บันทึกการจอง
        </button>
      </form>
    </div>
  </div>

  <script>
    // Global state
    let roomsData = [];
    let selectedRoom = null;
    let selectedCheckIn = "";
    let selectedCheckOut = "";
    let userLineIdGlobal = "";

    // หากต้องการใช้ LIFF ให้ uncomment ฟังก์ชัน initLiffGlobal และ DOMContentLoaded ข้างล่าง

    async function initLiffGlobal() {
      try {
        await liff.init({ liffId: "2007106715-87nBmwNL" });
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          const profile = await liff.getProfile();
          userLineIdGlobal = profile.userId;
          const hiddenField = document.getElementById("bookUserLineId");
          if (hiddenField) {
            hiddenField.value = profile.userId;
          }
        }
      } catch (err) {
        console.error("LIFF init error:", err);
      }
    }

    document.addEventListener("DOMContentLoaded", initLiffGlobal);

    // Utility: แปลงวันที่ในรูปแบบ DD-MM-YYYY เป็น Date object
    function parseDateDMY(dateStr) {
      const parts = dateStr.split("-");
      return new Date(parts[2], parts[1] - 1, parts[0]);
    }
    // Utility: คำนวณจำนวนคืน
    function calculateNights(checkIn, checkOut) {
      if (!checkIn || !checkOut) return "";
      const start = parseDateDMY(checkIn);
      const end = parseDateDMY(checkOut);
      if (end <= start) return "0";
      const diff = end - start;
      return Math.floor(diff / (1000 * 60 * 60 * 24));
    }

    // STEP 1: Room List
    async function fetchAllRooms() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();
        roomsData = data;
        renderRoomList(data, false);
      } catch (err) {
        console.error("Error fetching rooms:", err);
      }
    }
    async function fetchRooms(checkIn, checkOut) {
      try {
        const response = await fetch(
          `${API_URL}?checkIn=${checkIn}&checkOut=${checkOut}`
        );
        const data = await response.json();
        roomsData = data;
        renderRoomList(data, true);
      } catch (err) {
        console.error("Error fetching rooms:", err);
      }
    }

    /**
     * ฟังก์ชัน renderRoomList
     * - แยก "popular" แสดงก่อน
     * - ส่วนหมวดอื่น ๆ (otherRooms) ปรับการ์ดตามภาพแนบ
     */
    function renderRoomList(rooms, isStatusCalculated) {
      const container = document.getElementById("step1RoomList");
      container.innerHTML = "";

      if (!rooms || rooms.length === 0) {
        container.innerHTML =
          "<p class='text-gray-500'>ไม่มีห้องที่ตรงกับการค้นหา</p>";
        return;
      }
      // เรียงให้อยู่ก่อนถ้าว่าง
      if (isStatusCalculated) {
        rooms.sort((a, b) => {
          const sA = a["สถานะ"] ? a["สถานะ"].toLowerCase() : "";
          const sB = b["สถานะ"] ? b["สถานะ"].toLowerCase() : "";
          if (sA === "ว่าง" && sB === "ไม่ว่าง") return -1;
          if (sA === "ไม่ว่าง" && sB === "ว่าง") return 1;
          return 0;
        });
      }

      // เก็บวันที่ที่ผู้ใช้เลือก (ถ้ามี)
      const dateRange = document.getElementById("step1DateRange").value;
      let checkInDateValue = "";
      let checkOutDateValue = "";
      if (dateRange && dateRange.includes(" to ")) {
        const parts = dateRange.split(" to ");
        checkInDateValue = parts[0].trim();
        checkOutDateValue = parts[1].trim();
      }

      // แยกหมวด "popular" กับหมวดอื่น
      const popularRooms = rooms.filter(
        (room) =>
          room["หมวดหมู่"] &&
          room["หมวดหมู่"].toLowerCase() === "popular"
      );
      const otherRooms = rooms.filter(
        (room) =>
          !room["หมวดหมู่"] ||
          room["หมวดหมู่"].toLowerCase() !== "popular"
      );

      // ---------- ส่วน "popular" ----------
      if (popularRooms.length > 0) {
        const headingPopular = document.createElement("h3");
        headingPopular.className = "text-md font-bold mb-2";
        headingPopular.textContent = "⭐ POPULAR";
        container.appendChild(headingPopular);

        const poppularContainer = document.createElement("div");
        poppularContainer.className = "flex space-x-4 overflow-x-auto pb-4";
        container.appendChild(poppularContainer);

        popularRooms.forEach((room) => {
          let statusText = "";
          let statusColor = "";
          if (isStatusCalculated) {
            if (
              room["สถานะ"] &&
              room["สถานะ"].toLowerCase() === "ไม่ว่าง"
            ) {
              statusText = "ไม่ว่าง";
              statusColor = "bg-red-500";
            } else {
              statusText = "ว่าง";
              statusColor = "bg-green-500";
            }
          }

          // การ์ด "popular"
          const card = document.createElement("div");
          card.className =
            "relative w-48 h-40 rounded-lg overflow-hidden shadow flex-shrink-0";

          const bgImg = document.createElement("img");
          bgImg.src = room["รูปภาพ"];
          bgImg.alt = room["ชื่อ"] || "Room";
          bgImg.className = "absolute inset-0 w-full h-full object-cover";
          card.appendChild(bgImg);

          // gradient ด้านล่าง
          const gradientOverlay = document.createElement("div");
          gradientOverlay.className =
            "absolute inset-x-0 bottom-0 h-16 bg-gradient-to-t from-black/60 to-transparent";
          card.appendChild(gradientOverlay);

          // แสดงสถานะ (ว่าง/ไม่ว่าง) มุมบนขวา
          if (statusText) {
            const statusBadge = document.createElement("div");
            statusBadge.className = `absolute top-2 right-2 px-2 py-1 text-white text-xs rounded ${statusColor}`;
            statusBadge.textContent = statusText;
            card.appendChild(statusBadge);
          }

          // ชื่อ + ราคา
          const infoDiv = document.createElement("div");
          infoDiv.className = "absolute bottom-2 left-2 text-white";

          const title = document.createElement("div");
          title.className = "font-semibold text-sm";
          title.textContent = room["ชื่อ"] || "ไม่มีชื่อ";
          infoDiv.appendChild(title);

          const price = document.createElement("div");
          price.className = "text-sm";
          if (room["ราคาลด"]) {
            price.innerHTML = `
                <span class="line-through text-gray-200 mr-1">${room["ราคา"]}</span>
                <span class="font-bold">${room["ราคาลด"]}</span>
              `;
          } else {
            price.textContent = room["ราคา"] || "0";
          }
          infoDiv.appendChild(price);

          card.appendChild(infoDiv);

          // ปุ่ม "เลือก" มุมล่างขวา
          const selectBtn = document.createElement("button");
          selectBtn.className =
            "absolute bottom-2 right-2 bg-blue-500 text-white text-xs px-3 py-1 rounded-full shadow";
          selectBtn.textContent = "เลือก";
          selectBtn.addEventListener("click", (e) => {
            e.preventDefault();
            selectedRoom = room;
            selectedCheckIn = checkInDateValue;
            selectedCheckOut = checkOutDateValue;
            showStep("step2");
            populateDetail();
          });
          card.appendChild(selectBtn);

          poppularContainer.appendChild(card);
        });
      }

      // ---------- ส่วนหมวดอื่น ๆ (otherRooms) ----------
      if (otherRooms.length > 0) {
        const headingOthers = document.createElement("h3");
        headingOthers.className = "text-md font-bold mb-2";
        headingOthers.textContent = "🏠 ROOM";
        container.appendChild(headingOthers);

        otherRooms.forEach((room) => {
          // ตรวจสถานะ
          let statusText = "";
          let statusColor = "";
          if (isStatusCalculated) {
            if (
              room["สถานะ"] &&
              room["สถานะ"].toLowerCase() === "ไม่ว่าง"
            ) {
              statusText = "ไม่ว่าง";
              statusColor = "bg-red-500";
            } else {
              statusText = "ว่าง";
              statusColor = "bg-green-500";
            }
          }

          // สร้างการ์ดตามภาพตัวอย่าง
          const row = document.createElement("div");
          row.className =
            "bg-white rounded-lg shadow p-2 flex items-center mb-3";

          // รูปซ้าย
          const imgWrapper = document.createElement("div");
          imgWrapper.className = "w-24 h-16 overflow-hidden rounded";
          const img = document.createElement("img");
          img.src = room["รูปภาพ"];
          img.alt = room["ชื่อ"];
          img.className = "w-full h-full object-cover";
          imgWrapper.appendChild(img);
          row.appendChild(imgWrapper);

          // ตรงกลาง: ชื่อห้อง, หมวดหมู่, ราคา
          const middleDiv = document.createElement("div");
          middleDiv.className = "flex-1 px-3";

          // ชื่อห้อง
          const title = document.createElement("div");
          title.className = "font-bold text-sm";
          // ตัวอย่าง: "ห้อง เอ"
          // หากต้องการดึงจาก room["ชื่อ"] ตรง ๆ ก็เปลี่ยนได้เลย
          title.textContent = room["ชื่อ"] || "ไม่มีชื่อ";
          middleDiv.appendChild(title);

          // หมวดหมู่ (เช่น VIP)
          const category = document.createElement("div");
          category.className = "text-xs text-gray-500";
          category.textContent = room["หมวดหมู่"] || "";
          middleDiv.appendChild(category);

          // ราคา
          const priceLine = document.createElement("div");
          priceLine.className = "text-sm mt-1";
          if (room["ราคาลด"]) {
            // มีราคาลด => แสดงราคาเดิมขีดทับ + ราคาลดสีแดง
            priceLine.innerHTML = `
                <span class="text-gray-400 line-through mr-2 text-xs">${room["ราคา"]}</span>
                <span class="text-red-500 font-bold">${room["ราคาลด"]}</span>
              `;
          } else {
            // ไม่มีราคาลด => แสดงราคาปกติ
            priceLine.innerHTML = `
                <span class="text-red-500 font-bold">${room["ราคา"] || "0"}</span>
              `;
          }
          middleDiv.appendChild(priceLine);

          row.appendChild(middleDiv);

          // ด้านขวา: ปุ่มสถานะ + ปุ่มเลือก
          const rightDiv = document.createElement("div");
          rightDiv.className = "flex flex-col items-end space-y-1";

          // ปุ่มสถานะ
          if (statusText) {
            const statusBtn = document.createElement("button");
            statusBtn.className =
              "text-white text-xs px-3 py-1 rounded-full";
            statusBtn.textContent = statusText;
            // กำหนดสีปุ่มตามสถานะ
            statusBtn.classList.add(statusColor);
            rightDiv.appendChild(statusBtn);
          }

          // ปุ่ม "เลือก"
          const btnSelect = document.createElement("button");
          btnSelect.className =
            "bg-black text-white text-xs px-3 py-1 rounded-full";
          btnSelect.textContent = "เลือก";
          btnSelect.addEventListener("click", (e) => {
            e.preventDefault();
            selectedRoom = room;
            selectedCheckIn = checkInDateValue;
            selectedCheckOut = checkOutDateValue;
            showStep("step2");
            populateDetail();
          });
          rightDiv.appendChild(btnSelect);

          row.appendChild(rightDiv);
          container.appendChild(row);
        });
      }
    }

    // STEP 2: Detail Page
    function populateDetail() {
      if (!selectedRoom) return;

      const roomNameElem = document.getElementById("detailRoomName");
      const roomCategoryElem = document.getElementById("detailRoomCategory");
      const roomPriceElem = document.getElementById("detailRoomPrice");

      roomNameElem.textContent = selectedRoom["ชื่อ"] || "";
      roomCategoryElem.textContent =
        selectedRoom["หมวดหมู่"] ? `(${selectedRoom["หมวดหมู่"]})` : "";
      roomPriceElem.textContent = selectedRoom["ราคา"] || "0";

      // รูปหลัก
      const mainImgElement = document.getElementById("detailMainImg");
      mainImgElement.src = selectedRoom["รูปภาพ"] || "";
      mainImgElement.alt = selectedRoom["ชื่อ"] || "Room";

      // ฟีเจอร์
      const features = [];
      if (String(selectedRoom["แอร์"]).toLowerCase() === "true")
        features.push("แอร์");
      if (String(selectedRoom["ที่จอดรถ"]).toLowerCase() === "true")
        features.push("ที่จอดรถ");
      if (String(selectedRoom["สระน้ำ"]).toLowerCase() === "true")
        features.push("สระน้ำ");
      if (String(selectedRoom["วิว"]).toLowerCase() === "true")
        features.push("วิว");
      document.getElementById("detailFeatures").textContent =
        features.join(" • ");

      // แกลเลอรี
      const galleryContainer = document.getElementById("detailGallery");
      galleryContainer.innerHTML = "";
      for (let i = 1; i <= 4; i++) {
        const key = `รูปประกอบ-${i}`;
        if (selectedRoom[key]) {
          const img = document.createElement("img");
          img.src = selectedRoom[key];
          img.alt = key;
          img.className = "w-20 h-20 object-cover rounded cursor-pointer";
          img.addEventListener("click", () => {
            mainImgElement.src = selectedRoom[key];
            mainImgElement.alt = key;
          });
          galleryContainer.appendChild(img);
        }
      }

      // รายละเอียด
      document.getElementById("detailRoomDesc").textContent =
        selectedRoom["รายละเอียด"] || "";
      document.getElementById("detailRoomDesc2").textContent =
        selectedRoom["รายละเอียด-2"] || "";

      // ปุ่มจอง
      const bookingBtn = document.getElementById("detailBookBtn");
      if (!selectedCheckIn || !selectedCheckOut) {
        bookingBtn.disabled = true;
        bookingBtn.classList.add("opacity-50", "cursor-not-allowed");
        bookingBtn.textContent = "เลือกวันที่เข้าพักก่อน";
      } else if (
        selectedRoom["สถานะ"] &&
        selectedRoom["สถานะ"].toLowerCase() === "ไม่ว่าง"
      ) {
        bookingBtn.disabled = true;
        bookingBtn.classList.add("opacity-50", "cursor-not-allowed");
        bookingBtn.textContent = "ไม่ว่าง";
      } else {
        bookingBtn.disabled = false;
        bookingBtn.classList.remove("opacity-50", "cursor-not-allowed");
        bookingBtn.textContent = "จองห้องนี้";
        bookingBtn.onclick = () => {
          showStep("step3");
          populateBookingForm();
        };
      }
    }

    // STEP 3: Booking Form
    function populateBookingForm() {
      document.getElementById("bookRoomName").value =
        selectedRoom["ชื่อ"] || "";
      document.getElementById("bookRoomCategory").value =
        selectedRoom["หมวดหมู่"] || "";
      document.getElementById("bookRoomPrice").value =
        selectedRoom["ราคา"] || "";
      document.getElementById("bookCheckIn").value = selectedCheckIn;
      document.getElementById("bookCheckOut").value = selectedCheckOut;
      const nights = calculateNights(selectedCheckIn, selectedCheckOut);
      document.getElementById("bookNightCount").value = nights + " คืน";
    }

    // Step navigation
    function showStep(stepId) {
      document.getElementById("step1").classList.add("hidden");
      document.getElementById("step2").classList.add("hidden");
      document.getElementById("step3").classList.add("hidden");
      document.getElementById(stepId).classList.remove("hidden");
    }

    // Back buttons
    document.getElementById("backToStep1").addEventListener("click", () => {
      showStep("step1");
    });
    document.getElementById("backToStep2").addEventListener("click", () => {
      showStep("step2");
    });

    // Update room list when Step 1 date range changes via Flatpickr
    function updateRooms() {
      const dateRange = document.getElementById("step1DateRange").value;
      let checkIn = "";
      let checkOut = "";
      if (dateRange && dateRange.includes(" to ")) {
        const parts = dateRange.split(" to ");
        checkIn = parts[0].trim();
        checkOut = parts[1].trim();
      }
      if (checkIn && checkOut) {
        fetchRooms(checkIn, checkOut);
      } else {
        fetchAllRooms();
      }
    }
    document
      .getElementById("step1DateRange")
      .addEventListener("change", updateRooms);

    // เริ่มต้นเมื่อโหลดหน้า
    document.addEventListener("DOMContentLoaded", () => {
      // หากต้องการใช้ LIFF ให้เรียก initLiffGlobal() แทน
      // initLiffGlobal();

      // Initialize Flatpickr for date range input with format DD-MM-YYYY
      flatpickr("#step1DateRange", {
        mode: "range",
        dateFormat: "d-m-Y",
        onClose: updateRooms,
      });
      fetchAllRooms();
    });

    // Submit booking form
    document
      .getElementById("submitBookingBtn")
      .addEventListener("click", () => {
        const bookingData = {
          roomName: document.getElementById("bookRoomName").value,
          roomCategory: document.getElementById("bookRoomCategory").value,
          roomPrice: document.getElementById("bookRoomPrice").value,
          checkIn: document.getElementById("bookCheckIn").value,
          checkOut: document.getElementById("bookCheckOut").value,
          numGuests: document.getElementById("bookNumGuests").value,
          renterName: document.getElementById("bookRenterName").value,
          phone: document.getElementById("bookPhone").value,
          email: document.getElementById("bookEmail").value,
          note: document.getElementById("bookNote").value,
          userLineId: document.getElementById("bookUserLineId").value,
        };
        fetch(API_URL, {
          method: "POST",
          body: JSON.stringify(bookingData),
        })
          .then((response) => response.text())
          .then((data) => {
            console.log(data);
            alert("บันทึกการจองเรียบร้อย");
          })
          .catch((error) => console.error("Error:", error));
      });
  </script>
</body>

</html>
