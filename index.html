<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>โอมสเตย์ ยินดีต้อนรับ</title>
    <!-- Tailwind CSS ผ่าน CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include config.js สำหรับ API_URL (ระบุ URL ของ Web App ที่เผยแพร่) -->
    <script src="config.js"></script>
  </head>
  <body class="bg-gray-100 min-h-screen">
    <div class="max-w-md mx-auto p-4">
      <!-- Header -->
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-lg font-bold">โอมสเตย์ ยินดีต้อนรับ</h1>
        <div class="w-10 h-10 bg-gray-300 rounded-full"></div>
      </div>

      <!-- เลือกวันที่เข้าพัก -->
      <div class="flex items-center bg-white rounded-full px-4 py-2 mb-6 shadow-sm">
        <label class="text-sm text-gray-500">วันที่เข้าพัก</label>
        <input type="date" id="checkInDate" class="text-sm text-right ml-auto focus:outline-none" />
      </div>

      <!-- หัวข้อแสดงผลห้องที่มีสถานะ -->
      <h2 class="mb-3 font-semibold text-gray-700">ห้องที่มีสถานะ</h2>

      <!-- รายการห้อง -->
      <div id="roomList" class="space-y-4"></div>
    </div>

    <script>
      // ฟังก์ชันดึงข้อมูลห้องจาก API โดยส่งค่าวันที่เข้าพักเป็น query parameter
      async function fetchRooms(selectedDate) {
        try {
          // API_URL ควรระบุ URL ของ Web App ที่เผยแพร่จาก Google Apps Script
          const response = await fetch(`${API_URL}?checkIn=${selectedDate}`);
          const data = await response.json();
          renderRoomList(data);
        } catch (err) {
          console.error("Error fetching rooms:", err);
        }
      }

      // ฟังก์ชันแสดงรายการห้องพร้อมสถานะ
      function renderRoomList(rooms) {
        const container = document.getElementById("roomList");
        container.innerHTML = "";

        if (!rooms || rooms.length === 0) {
          container.innerHTML = "<p class='text-gray-500'>ไม่มีห้องที่ตรงกับการค้นหา</p>";
          return;
        }

        rooms.forEach((room) => {
          const card = document.createElement("div");
          card.className = "flex items-center bg-white rounded-lg p-3 shadow";

          // รูปห้อง
          const img = document.createElement("img");
          img.src = room["รูปภาพ"];
          img.alt = room["ชื่อ"];
          img.className = "w-20 h-20 object-cover rounded-md mr-3";

          // ข้อมูลห้อง
          const info = document.createElement("div");
          info.className = "flex-1";

          const title = document.createElement("div");
          title.className = "font-semibold text-sm";
          title.textContent = room["ชื่อ"];

          // สร้าง label แสดงสถานะห้อง
          const statusLabel = document.createElement("div");
          statusLabel.className = "text-xs text-center px-2 py-1 rounded-full mt-1";
          if (room["สถานะ"] && room["สถานะ"].toLowerCase() === "ไม่ว่าง") {
            statusLabel.textContent = "ไม่ว่าง";
            statusLabel.classList.add("bg-red-200", "text-red-700");
          } else {
            statusLabel.textContent = "ว่าง";
            statusLabel.classList.add("bg-green-200", "text-green-700");
          }

          // ฟีเจอร์เพิ่มเติม (เช่น แอร์, ที่จอดรถ, สระน้ำ, วิว)
          const features = [];
          if (String(room["แอร์"]).toLowerCase() === "true") features.push("แอร์");
          if (String(room["ที่จอดรถ"]).toLowerCase() === "true") features.push("ที่จอดรถ");
          if (String(room["สระน้ำ"]).toLowerCase() === "true") features.push("สระน้ำ");
          if (String(room["วิว"]).toLowerCase() === "true") features.push("วิว");

          const featureElem = document.createElement("div");
          featureElem.className = "text-xs text-gray-500 mt-1";
          featureElem.textContent = features.join(" • ");

          info.appendChild(title);
          info.appendChild(statusLabel);
          info.appendChild(featureElem);

          // ราคาและปุ่มเลือก
          const rightBox = document.createElement("div");
          rightBox.className = "text-right ml-2";

          const price = document.createElement("div");
          price.className = "text-red-500 font-bold text-lg";
          price.textContent = room["ราคา"] || "0";

          const detailBtn = document.createElement("a");
          detailBtn.href = `detail.html?id=${room["ไอดี"]}`;
          detailBtn.className = "bg-pink-500 text-white text-sm px-4 py-1 rounded inline-block mt-2";
          detailBtn.textContent = "เลือก";

          rightBox.appendChild(price);
          rightBox.appendChild(detailBtn);

          card.appendChild(img);
          card.appendChild(info);
          card.appendChild(rightBox);
          container.appendChild(card);
        });
      }

      // เมื่อมีการเปลี่ยนแปลงวันที่เข้าพัก ให้เรียกดึงข้อมูลห้อง
      document.getElementById("checkInDate").addEventListener("change", function() {
        const selectedDate = this.value;
        if (selectedDate) {
          fetchRooms(selectedDate);
        }
      });
    </script>
  </body>
</html>
